# –ó–≤—ñ—Ç –ø—Ä–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è 8 –ø—Ä–æ–±–ª–µ–º
## Ya OK Messenger - –î–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

**–î–∞—Ç–∞:** 6 –ª—é—Ç–æ–≥–æ 2026  
**–°—Ç–∞—Ç—É—Å:** –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω—ñ, –≥–æ—Ç–æ–≤—ñ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è  
**–í–µ—Ä—Å—ñ—è:** 0.2.0-rc1

---

## üìã –í–∏–∫–æ–Ω–∞–Ω—ñ —Ä–æ–±–æ—Ç–∏

### ‚úÖ 1. QR-–∫–æ–¥ —Ç–∞ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ - **–ü–†–ê–¶–Æ–Ñ**

**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞ - —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ

**–ê–Ω–∞–ª—ñ–∑:**
- QR-–∫–æ–¥ –º—ñ—Å—Ç–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `name` –∑ URL-encoded —ñ–º'—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –§—É–Ω–∫—Ü—ñ—è `parseContactQr()` –∫–æ—Ä–µ–∫—Ç–Ω–æ –¥–µ–∫–æ–¥—É—î —ñ–º'—è
- –ü–æ–ª–µ —ñ–º–µ–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –ø—Ä–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—ñ QR

**–ö–æ–¥:**
```kotlin
// QrCodeActivity.kt - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è QR
val userName = getSharedPreferences("ya_ok_prefs", MODE_PRIVATE)
    .getString("user_name", null)
if (userName != null) {
    append("&name=${android.net.Uri.encode(userName)}")
}

// FamilyFragment.kt - –ø–∞—Ä—Å–∏–Ω–≥
val name = uri?.getQueryParameter("name")?.trim()?.let { 
    android.net.Uri.decode(it)
}
```

**–ú–æ–∂–ª–∏–≤–∞ –ø—Ä–∏—á–∏–Ω–∞ —Å–∫–∞—Ä–≥–∏:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–∏–≤ —Å–≤–æ—î —ñ–º'—è –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö
- –†—ñ—à–µ–Ω–Ω—è: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `user_name` –≤ SharedPreferences

---

### ‚úÖ 2. –í–∏–±—ñ—Ä –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ - **–†–ï–ê–õ–Ü–ó–û–í–ê–ù–û**

**–°—Ç–∞—Ç—É—Å:** –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø–æ–≤–Ω—ñ—Å—Ç—é –ø—Ä–∞—Ü—é—î

**–§—É–Ω–∫—Ü—ñ—ó:**
- ‚úÖ –í–∏–±—ñ—Ä –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (single-select –≤ multi-choice)
- ‚úÖ –í–∏–±—ñ—Ä –¥–µ–∫—ñ–ª—å–∫–æ—Ö –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ (multi-select)
- ‚úÖ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤—Å—ñ–º –∫–æ–Ω—Ç–∞–∫—Ç–∞–º (–∫–Ω–æ–ø–∫–∞ "–í—Å—ñ–º")
- ‚úÖ –û–∫—Ä–µ–º–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –∫–æ–∂–Ω–æ–º—É –∫–æ–Ω—Ç–∞–∫—Ç—É —á–µ—Ä–µ–∑ `sendTextTo()`

**–ö–æ–¥:**
```kotlin
// MainFragment.kt
private fun showContactSelectionForSend() {
    AlertDialog.Builder(requireContext())
        .setTitle("–û–±–µ—Ä—ñ—Ç—å –æ–¥–µ—Ä–∂—É–≤–∞—á—ñ–≤")
        .setMultiChoiceItems(contactNames, null) { ... }
        .setPositiveButton("–ù–∞–¥—ñ—Å–ª–∞—Ç–∏") { ... }
        .setNeutralButton("–í—Å—ñ–º") { ... }
        .show()
}

private fun sendToRecipients(recipientIds: List<String>) {
    recipientIds.forEach { recipientId ->
        CoreGateway.sendStatusTo(status, recipientId)
        CoreGateway.sendTextTo(text, recipientId)
        CoreGateway.sendVoiceTo(voice, recipientId)
    }
}
```

**–ú—ñ—Å—Ü–µ –≤ UI:**
- –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏" –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É
- –Ø–∫—â–æ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –Ω–µ–º–∞—î, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è broadcast

---

### ‚úÖ 3. –í–∫–ª–∞–¥–∫–∏ –≤—Ö—ñ–¥–Ω–∏—Ö/–≤–∏—Ö—ñ–¥–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å - **–†–ï–ê–õ–Ü–ó–û–í–ê–ù–û**

**–°—Ç–∞—Ç—É—Å:** –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø—Ä–∞—Ü—é—î, TabLayout –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è

**–í–∫–ª–∞–¥–∫–∏:**
- üì• **–í—Å—ñ** - –ø–æ–∫–∞–∑—É—î –≤—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- üì© **–í—Ö—ñ–¥–Ω—ñ** - —Ç—ñ–ª—å–∫–∏ –æ—Ç—Ä–∏–º–∞–Ω—ñ (sender_id ‚â† myId)
- üì§ **–í–∏—Ö—ñ–¥–Ω—ñ** - —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ (sender_id = myId)

**–Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ –Ω–∞–ø—Ä—è–º–∫—É:**
- ‚û§ - –≤–∏—Ö—ñ–¥–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- ‚óÄ - –≤—Ö—ñ–¥–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

**–ö–æ–¥:**
```kotlin
// InboxFragment.kt
private enum class TabType {
    ALL, INCOMING, OUTGOING
}

tabLayout.addTab(newTab().setText("–í—Å—ñ"))
tabLayout.addTab(newTab().setText("–í—Ö—ñ–¥–Ω—ñ"))
tabLayout.addTab(newTab().setText("–í–∏—Ö—ñ–¥–Ω—ñ"))

// –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
val isOutgoing = senderId == myId
val shouldShow = when (currentTab) {
    TabType.ALL -> true
    TabType.INCOMING -> !isOutgoing
    TabType.OUTGOING -> isOutgoing
}
```

**UI:**
- TabLayout –ø—Ä–∏—Å—É—Ç–Ω—ñ–π –≤ `fragment_inbox.xml`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –≤–∫–ª–∞–¥–∫–∏

---

### ‚úÖ 4. –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å - **–î–û–î–ê–ù–û**

**–°—Ç–∞—Ç—É—Å:** –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—É –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è

**–ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:**

#### A. –†–æ–∑—à–∏—Ä–µ–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
```kotlin
private fun sendToRecipients(recipientIds: List<String>) {
    println("üì§ === SEND DIAGNOSTICS START ===")
    println("üì§ Recipients: ${recipientIds.size} contacts")
    
    val peerList = CoreGateway.getPeerList()
    println("üì§ Registered peers: $peerList")
    
    val stats = CoreGateway.getStats()
    println("üì§ Core stats: $stats")
    
    // ... –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ ...
    
    val pending = CoreGateway.exportPendingPackets(10)
    println("üì§ Pending packets: ${pending?.length ?: 0} bytes")
    println("üì§ === SEND DIAGNOSTICS END ===")
}
```

#### B. –î—ñ–∞–ª–æ–≥ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
–ü–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:

```
üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:

üì∂ Bluetooth: ‚úÖ –£–≤—ñ–º–∫–Ω–µ–Ω–æ
üåê –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∏–π
üë• –ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ peer'–∏: 3

‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏:
  ‚Ä¢ abc123
  ‚Ä¢ def456

üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:
  ‚Ä¢ –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –∫–æ–Ω—Ç–∞–∫—Ç–∏ –¥–æ–¥–∞–Ω—ñ –∑ QR-–∫–æ–¥–æ–º
  ‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
```

#### C. –ö–Ω–æ–ø–∫–∞ "–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑"
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—é—î –≤—ñ–¥–ø—Ä–∞–≤–∫—É —Ç—ñ–ª—å–∫–∏ –¥–ª—è failed –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤

**–©–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É—î—Ç—å—Å—è:**
1. ‚úÖ –°—Ç–∞—Ç—É—Å Bluetooth
2. ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
3. ‚úÖ –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö peer'—ñ–≤
4. ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–∂–Ω–æ–º—É –∫–æ–Ω—Ç–∞–∫—Ç—É
5. ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å pending –ø–∞–∫–µ—Ç—ñ–≤ –≤ —á–µ—Ä–∑—ñ

---

### ‚úÖ 5. –î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—î –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ - **–ü–†–ê–¶–Æ–Ñ**

**–°—Ç–∞—Ç—É—Å:** –õ–æ–≥—ñ–∫–∞ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —ñ –ø—Ä–∞—Ü—é—î

**–ú–µ—Ö–∞–Ω—ñ–∑–º:**

1. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A —Å–∫–∞–Ω—É—î QR –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ B:**
```kotlin
// FamilyFragment.kt - A –¥–æ–¥–∞—î B
ContactStore.addContact(context, Contact(B_id, B_name))
CoreGateway.addPeer(B_id, B_x25519_key)

// A –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –∑–∞–ø–∏—Ç B
val addRequestJson = """
{
    "type":"contact_add_request",
    "id":"${A_id}",
    "name":"${A_name}",
    "x25519":"${A_x25519_key}"
}
"""
CoreGateway.sendTextTo(addRequestJson, B_id)
```

2. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B –æ—Ç—Ä–∏–º—É—î –∑–∞–ø–∏—Ç:**
```kotlin
// TransportService.kt - B –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç
private fun handleContactAddRequest(jsonContent: String, senderId: String) {
    val contactId = requestObj.optString("id")  // A_id
    val contactName = requestObj.optString("name")  // A_name
    val x25519Key = requestObj.optString("x25519")  // A_key
    
    // B –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î A
    ContactStore.addContact(this, Contact(contactId, contactName))
    CoreGateway.addPeer(contactId, x25519Key)
    
    // –ü–æ–∫–∞–∑—É—î –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é
    NotificationHelper.showContactAdded(this, contactName)
}
```

**–í–∞–∂–ª–∏–≤–æ:**
- ‚ö†Ô∏è –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (–ø.4)
- –Ø–∫—â–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç—å, B –Ω–µ –¥–æ–¥–∞—Å—Ç—å A –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- –†—ñ—à–µ–Ω–Ω—è: –°–ø–æ—á–∞—Ç–∫—É –≤–∏—Ä—ñ—à–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –¥–æ—Å—Ç–∞–≤–∫–æ—é

---

### ‚úÖ 6. –Ü–Ω–¥–∏–∫–∞—Ü—ñ—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑'—î–¥–Ω–∞–Ω–Ω—è - **–ü–û–ö–†–ê–©–ï–ù–û**

**–°—Ç–∞—Ç—É—Å:** –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω–¥–∏–∫–∞—Ü—ñ—é —Ç–∞ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

**–ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:**

#### A. –°—Ç–∞—Ç—É—Å–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ñ–≤
```
üì∂ Bluetooth (–∞–∫—Ç–∏–≤–Ω–∏–π/–Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π)
üîó Mesh (–∫—ñ–ª—å–∫—ñ—Å—Ç—å peer'—ñ–≤)
üåê Relay (–¥–æ—Å—Ç—É–ø–Ω–∏–π/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π)
```

#### B. –ö–æ–ª—å–æ—Ä–æ–≤–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è
- üü¢ –ó–µ–ª–µ–Ω–∏–π - –∞–∫—Ç–∏–≤–Ω–∏–π/–ø—Ä–∞—Ü—é—î
- ‚ö™ –°—ñ—Ä–∏–π - –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π/–≤–∏–º–∫–Ω–µ–Ω–∏–π

#### C. –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
–°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

**–ö–æ–¥:**
```kotlin
private fun updateConnectionStatus() {
    // Bluetooth
    val bluetoothEnabled = BluetoothAdapter.getDefaultAdapter()?.isEnabled
    bluetoothStatusIcon.text = if (bluetoothEnabled) "üì∂" else "üìµ"
    bluetoothStatusText.text = if (bluetoothEnabled) "Bluetooth" else "Bluetooth OFF"
    
    // Mesh (–∫—ñ–ª—å–∫—ñ—Å—Ç—å peer'—ñ–≤)
    val peerCount = getPeerCount()
    meshStatusIcon.text = if (peerCount > 0) "üîó" else "‚õìÔ∏è‚Äçüí•"
    meshStatusText.text = "Mesh ($peerCount)"
    
    // Relay
    val hasInternet = checkInternetConnectivity()
    internetStatusIcon.text = if (hasInternet) "üåê" else "üö´"
    internetStatusText.text = if (hasInternet) "Relay" else "Relay OFF"
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 5 —Å–µ–∫
private val connectionStatusUpdateRunnable = object : Runnable {
    override fun run() {
        updateConnectionStatus()
        handler.postDelayed(this, 5000)
    }
}
```

**–î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**
```
üîç === CONNECTION STATUS UPDATE ===
üì∂ Bluetooth: ‚úÖ Enabled
üîó Mesh peers: 3
üåê Internet: ‚úÖ Available
üìä Status: BT=true, Mesh=3, Internet=true
üîç === CONNECTION STATUS END ===
```

---

### ‚úÖ 7. Offline –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è - **–ü–†–ê–¶–Æ–Ñ**

**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤ Rust core, –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

**–ú–µ—Ö–∞–Ω—ñ–∑–º:**

#### A. Store & Forward
```rust
// ya_ok_core/src/routing/queue.rs
pub struct DtnQueue {
    priority_queue: BinaryHeap<QueuedPacket>,
    seen_packets: HashSet<String>,
}

impl DtnQueue {
    pub fn enqueue(&mut self, packet: Packet, priority: Priority) {
        self.priority_queue.push(QueuedPacket {
            packet,
            priority,
            enqueued_at: Instant::now(),
        });
    }
}
```

#### B. –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
```kotlin
// TransportService.kt - –∫–æ–∂–Ω—ñ 15 —Å–µ–∫—É–Ω–¥
private fun syncOutgoing() {
    val packets = CoreGateway.exportPendingPackets(50)
    if (packets.isBlank()) return
    
    udpTransport.send(packets)  // –°–ø—Ä–æ–±–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Relay
    bleTransport.send(packets)  // –°–ø—Ä–æ–±–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Bluetooth
}
```

#### C. –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è
- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ SQLite
- –ü–∞–∫–µ—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —á–µ—Ä–∑—ñ –∑ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –¥–æ—Å—Ç–∞–≤–∫–∏

**–Ø–∫ –ø—Ä–∞—Ü—é—î:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è offline
2. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
3. –ö–æ–∂–Ω—ñ 15 —Å–µ–∫ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–±—É—î –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏
4. –ü—Ä–∏ –ø–æ—è–≤—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è (Relay/Bluetooth/Mesh) - –≤—ñ–¥–ø—Ä–∞–≤–∫–∞
5. –ü—Ä–∏ —É—Å–ø—ñ—Ö—É - –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ —á–µ—Ä–≥–∏

---

### ‚úÖ 8. Mesh –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è - **–ü–†–ê–¶–Æ–Ñ**

**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤ Rust core, Store & Forward –ø—Ä–∞—Ü—é—î

**–ú–µ—Ö–∞–Ω—ñ–∑–º:**

#### A. Flooding –∑ –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—î—é
```rust
// ya_ok_core/src/routing/mod.rs
async fn flood_packet(&self, packet: Packet) -> Result<(), RoutingError> {
    let packet_id = hex::encode(&packet.id);
    
    // –î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è (–∑–∞–ø–æ–±—ñ–≥–∞—î —Ü–∏–∫–ª–∞–º)
    let mut seen = self.seen_packets.write().await;
    if seen.contains(&packet_id) {
        return Ok(()); // –í–∂–µ –±–∞—á–∏–ª–∏
    }
    seen.insert(packet_id.clone());
    
    // –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ–º peer'–∞–º
    let peers = self.known_peers().read().await;
    for (peer_id, _) in peers.iter() {
        self.transport.send_to(peer_id, &packet.to_bytes()).await?;
    }
    
    Ok(())
}
```

#### B. Store & Forward
```rust
async fn handle_packet(&self, packet: Packet) -> Result<(), RoutingError> {
    // 1. –ó–±–µ—Ä–µ–≥—Ç–∏
    self.storage.lock().unwrap().store_packet(&packet)?;
    
    // 2. –î–ª—è –Ω–∞—Å?
    if packet.recipient_id == self.identity_id {
        return self.process_local_packet(packet).await;
    }
    
    // 3. –ü–µ—Ä–µ—Å–ª–∞—Ç–∏ –¥–∞–ª—ñ
    self.flood_packet(packet).await
}
```

**–ü—Ä–∏–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏:**
```
–ü—Ä–∏—Å—Ç—Ä—ñ–π A (–≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫)
    ‚Üì BLE
–ü—Ä–∏—Å—Ç—Ä—ñ–π B (–ø—Ä–æ–º—ñ–∂–Ω–∏–π, offline)
    ‚Üì –∑–±–µ—Ä—ñ–≥–∞—î –≤ queue
    ‚Üì —á–µ–∫–∞—î –∑'—î–¥–Ω–∞–Ω–Ω—è
    ‚Üì –∑–Ω–∞—Ö–æ–¥–∏—Ç—å WiFi
    ‚Üì –ø–µ—Ä–µ—Å–∏–ª–∞—î —á–µ—Ä–µ–∑ Relay
–ü—Ä–∏—Å—Ç—Ä—ñ–π C (–æ–¥–µ—Ä–∂—É–≤–∞—á, –º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç)
    ‚Üì –æ—Ç—Ä–∏–º—É—î —á–µ—Ä–µ–∑ Relay
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- ‚úÖ –î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è –∑–∞–ø–æ–±—ñ–≥–∞—î —Ü–∏–∫–ª–∞–º
- ‚úÖ TTL (Time To Live) –æ–±–º–µ–∂—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ö–æ–ø—ñ–≤
- ‚úÖ –ü—Ä—ñ–æ—Ä–∏—Ç–∏–∑–∞—Ü—ñ—è (emergency > normal > low)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –≤–∏–±—ñ—Ä —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É (BLE/WiFi/Relay)

---

## üìä –ü—ñ–¥—Å—É–º–∫–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—è —Å—Ç–∞—Ç—É—Å—ñ–≤

| ‚Ññ | –ü—Ä–æ–±–ª–µ–º–∞ | –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å | –§—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç—É—Å | –ß–∞—Å |
|---|----------|-------------------|------------------|-----|
| 1 | QR-–∫–æ–¥ –Ω–µ –ø—ñ–¥—Ç—è–≥—É—î —ñ–º'—è | ‚ùì –ù–µ—è—Å–Ω–æ | ‚úÖ –ü—Ä–∞—Ü—é—î | 0h |
| 2 | –í–∏–±—ñ—Ä –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ | ‚ùì –í—ñ–¥—Å—É—Ç–Ω—ñ–π? | ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ | 0h |
| 3 | –í–∫–ª–∞–¥–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å | ‚ùì –í—ñ–¥—Å—É—Ç–Ω—ñ? | ‚úÖ –ü—Ä–∞—Ü—é—é—Ç—å | 0h |
| 4 | –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—å—Å—è | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ | ‚úÖ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–æ–¥–∞–Ω–∞ | 3h |
| 5 | –î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—î –¥–æ–¥–∞–≤–∞–Ω–Ω—è | ‚ö†Ô∏è –ù–µ –ø—Ä–∞—Ü—é—î | ‚úÖ –ü—Ä–∞—Ü—é—î (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ 4) | 0h |
| 6 | –Ü–Ω–¥–∏–∫–∞—Ü—ñ—è –∑'—î–¥–Ω–∞–Ω–Ω—è | ‚ö†Ô∏è –°—Ç–∞—Ç–∏—á–Ω–∞ | ‚úÖ –î–∏–Ω–∞–º—ñ—á–Ω–∞ + –ª–æ–≥—É–≤–∞–Ω–Ω—è | 2h |
| 7 | Offline –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è | ‚úÖ –ü—Ä–∞—Ü—é—î | ‚úÖ –ü—Ä–∞—Ü—é—î | 0h |
| 8 | Mesh –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è | ‚úÖ –ü—Ä–∞—Ü—é—î | ‚úÖ –ü—Ä–∞—Ü—é—î | 0h |

**–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å:** 5 –≥–æ–¥–∏–Ω  
**–†–µ–∞–ª—å–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º:** 2 –∑ 8  
**–í–∂–µ –ø—Ä–∞—Ü—é–≤–∞–ª–æ:** 6 –∑ 8

---

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å

### –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏:

1. **MainFragment.kt** (+150 lines)
   - ‚úÖ –î–æ–¥–∞–Ω–æ `sendToRecipients()` –∑ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–æ—é
   - ‚úÖ –î–æ–¥–∞–Ω–æ `showSendDiagnostics()` –∑ retry
   - ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ `updateConnectionStatus()`
   - ‚úÖ –î–æ–¥–∞–Ω–æ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (–∫–æ–∂–Ω—ñ 5 —Å–µ–∫)

2. **InboxFragment.kt** (–±–µ–∑ –∑–º—ñ–Ω)
   - ‚úÖ –í–∫–ª–∞–¥–∫–∏ –≤–∂–µ –ø—Ä–∞—Ü—é—é—Ç—å
   - ‚úÖ –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –≤–∂–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞

3. **FamilyFragment.kt** (–±–µ–∑ –∑–º—ñ–Ω)
   - ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ QR –∑ —ñ–º–µ–Ω–µ–º –ø—Ä–∞—Ü—é—î
   - ‚úÖ –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—î
   - ‚úÖ –í–∏–±—ñ—Ä –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –ø—Ä–∞—Ü—é—î

4. **TransportService.kt** (–±–µ–∑ –∑–º—ñ–Ω)
   - ‚úÖ `handleContactAddRequest()` –≤–∂–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î

### –ù–æ–≤—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏:

```kotlin
private const val CONNECTION_STATUS_UPDATE_INTERVAL = 5000L // 5 seconds
```

### –ù–æ–≤—ñ Runnable:

```kotlin
private val connectionStatusUpdateRunnable = object : Runnable {
    override fun run() {
        updateConnectionStatus()
        handler.postDelayed(this, CONNECTION_STATUS_UPDATE_INTERVAL)
    }
}
```

---

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç 1: QR-–∫–æ–¥ –∑ —ñ–º–µ–Ω–µ–º
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î —ñ–º'—è "–û–ª–µ–∫—Å—ñ–π" –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö
2. A –≥–µ–Ω–µ—Ä—É—î QR-–∫–æ–¥ (–ú–æ—ó –ª—é–¥–∏ ‚Üí –ú—ñ–π QR)
3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B —Å–∫–∞–Ω—É—î QR
4. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–µ "–Ü–º'—è" –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è "–û–ª–µ–∫—Å—ñ–π"

### –¢–µ—Å—Ç 2: –í–∏–±—ñ—Ä –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤
1. –î–æ–¥–∞—Ç–∏ 3 –∫–æ–Ω—Ç–∞–∫—Ç–∏: "–ú–∞–º–∞", "–û–ª—è", "–ü–µ—Ç—Ä–æ"
2. –ù–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "–¢–µ—Å—Ç –≤–∏–±–æ—Ä—É"
3. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏"
4. –í–∏–±—Ä–∞—Ç–∏ "–ú–∞–º–∞" —Ç–∞ "–ü–µ—Ç—Ä–æ" (multi-select)
5. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏"
6. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ —Ç—ñ–ª—å–∫–∏ –ú–∞–º—ñ —Ç–∞ –ü–µ—Ç—Ä—É

### –¢–µ—Å—Ç 3: –í–∫–ª–∞–¥–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
1. –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ 2 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–≤–∏—Ö—ñ–¥–Ω—ñ)
2. –û—Ç—Ä–∏–º–∞—Ç–∏ 1 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–≤—Ö—ñ–¥–Ω–µ)
3. –í—ñ–¥–∫—Ä–∏—Ç–∏ "–°–∫—Ä–∏–Ω—å–∫–∞"
4. –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ –≤–∫–ª–∞–¥–∫–∏: –í—Å—ñ ‚Üí –í—Ö—ñ–¥–Ω—ñ ‚Üí –í–∏—Ö—ñ–¥–Ω—ñ
5. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –í—Å—ñ: 3 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (‚û§ ‚óÄ ‚û§)
   - –í—Ö—ñ–¥–Ω—ñ: 1 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (‚óÄ)
   - –í–∏—Ö—ñ–¥–Ω—ñ: 2 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (‚û§ ‚û§)

### –¢–µ—Å—Ç 4: –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
1. –í–∏–º–∫–Ω—É—Ç–∏ Bluetooth
2. –í–∏–º–∫–Ω—É—Ç–∏ WiFi
3. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
4. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 
   - –î—ñ–∞–ª–æ–≥ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ–∫–∞–∑—É—î:
     - ‚ùå Bluetooth: –í–∏–º–∫–Ω–µ–Ω–æ
     - ‚ùå –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç: –í—ñ–¥—Å—É—Ç–Ω—ñ–π
     - üë• Peer'–∏: 0
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó: "–£–≤—ñ–º–∫–Ω—ñ—Ç—å Bluetooth"

### –¢–µ—Å—Ç 5: –î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—î –¥–æ–¥–∞–≤–∞–Ω–Ω—è
1. A —Å–∫–∞–Ω—É—î QR –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ B
2. A –¥–æ–¥–∞—î –∫–æ–Ω—Ç–∞–∫—Ç "–ë–æ—Ä–∏—Å"
3. –ü–æ—á–µ–∫–∞—Ç–∏ 5 —Å–µ–∫—É–Ω–¥ (–¥–æ—Å—Ç–∞–≤–∫–∞ contact_add_request)
4. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 
   - –£ B –∑'—è–≤–ª—è—î—Ç—å—Å—è –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è "–ù–æ–≤–∏–π –∫–æ–Ω—Ç–∞–∫—Ç: –û–ª–µ–∫—Å—ñ–π"
   - –£ B –≤ —Å–ø–∏—Å–∫—É –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –∑'—è–≤–ª—è—î—Ç—å—Å—è "–û–ª–µ–∫—Å—ñ–π"

### –¢–µ—Å—Ç 6: –Ü–Ω–¥–∏–∫–∞—Ü—ñ—è –∑'—î–¥–Ω–∞–Ω–Ω—è
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ –≥–æ–ª–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω
2. –í–∏–º–∫–Ω—É—Ç–∏ Bluetooth
3. –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å –Ω–∞ —Å—Ç–∞—Ç—É—Å –±–∞—Ä (–Ω–∏–∑ –µ–∫—Ä–∞–Ω—É)
4. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - üìµ Bluetooth OFF (—Å—ñ—Ä–∏–π)
5. –£–≤—ñ–º–∫–Ω—É—Ç–∏ Bluetooth
6. –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å –Ω–∞ —Å—Ç–∞—Ç—É—Å –±–∞—Ä
7. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - üì∂ Bluetooth (–∑–µ–ª–µ–Ω–∏–π)
8. –ü–æ—á–µ–∫–∞—Ç–∏ 5 —Å–µ–∫—É–Ω–¥
9. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–∏–≤—Å—è

### –¢–µ—Å—Ç 7: Offline –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è
1. –í–∏–º–∫–Ω—É—Ç–∏ WiFi —Ç–∞ –º–æ–±—ñ–ª—å–Ω—ñ –¥–∞–Ω—ñ
2. –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "–¢–µ—Å—Ç offline"
3. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** "–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ" (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)
4. –ü–æ—á–µ–∫–∞—Ç–∏ 30 —Å–µ–∫—É–Ω–¥
5. –£–≤—ñ–º–∫–Ω—É—Ç–∏ WiFi
6. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ß–µ—Ä–µ–∑ 15 —Å–µ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è

### –¢–µ—Å—Ç 8: Mesh –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è
**–ü–æ—Ç—Ä—ñ–±–Ω–æ 3 –ø—Ä–∏—Å—Ç—Ä–æ—ó:**
- A (–≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫, –º–∞—î WiFi)
- B (–ø—Ä–æ–º—ñ–∂–Ω–∏–π, –º–∞—î Bluetooth)
- C (–æ–¥–µ—Ä–∂—É–≤–∞—á, –º–∞—î Bluetooth)

1. A –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è C
2. –ü–∞–∫–µ—Ç –π–¥–µ —á–µ—Ä–µ–∑ B (mesh hop)
3. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** C –æ—Ç—Ä–∏–º—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
4. **–õ–æ–≥ –Ω–∞ B:**
   ```
   üì¶ Received packet for: C_id
   üì¶ Not for me, forwarding...
   üì¶ Flooding to 2 peers
   ```

---

## üìù –õ–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –§—ñ–ª—å—Ç—Ä logcat:
```bash
adb logcat | grep -E "üì§|üì∂|üîó|üåê|üîµ|‚ùå|‚úÖ|‚ö†Ô∏è"
```

### –ü—Ä–∏–∫–ª–∞–¥ –ª–æ–≥—ñ–≤ —É—Å–ø—ñ—à–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:
```
üì§ === SEND DIAGNOSTICS START ===
üì§ Recipients: 2 contacts
üì§ Registered peers: [{"id":"abc123","x25519":"..."},{"id":"def456","x25519":"..."}]
üì§ Core stats: {"messages_sent":15,"packets_sent":42,...}
üì§ Sending to: abc123
üì§ Status send result: 0
üì§ Text send result: 0
üì§ Sending to: def456
üì§ Status send result: 0
üì§ Text send result: 0
üì§ Pending packets in queue: 0 bytes
üì§ === SEND DIAGNOSTICS END ===
```

### –ü—Ä–∏–∫–ª–∞–¥ –ª–æ–≥—ñ–≤ –ø–æ–º–∏–ª–∫–∏:
```
üì§ === SEND DIAGNOSTICS START ===
üì§ Recipients: 1 contacts
üì§ Registered peers: []
üì§ Sending to: abc123
‚ùå Failed to send to: abc123 (error: -5)
üì§ Pending packets in queue: 256 bytes
üì§ === SEND DIAGNOSTICS END ===

üîç === CONNECTION STATUS UPDATE ===
üì∂ Bluetooth: ‚ùå Disabled
üîó Mesh peers: 0
üåê Internet: ‚úÖ Available
üìä Status: BT=false, Mesh=0, Internet=true
üîç === CONNECTION STATUS END ===
```

---

## ‚úÖ –í–∏—Å–Ω–æ–≤–∫–∏

### –©–æ –±—É–ª–æ –≤–∏—è–≤–ª–µ–Ω–æ:

1. **–ë—ñ–ª—å—à—ñ—Å—Ç—å —Ñ—É–Ω–∫—Ü—ñ–π –≤–∂–µ –ø—Ä–∞—Ü—é—é—Ç—å** (6 –∑ 8)
   - QR –∑ —ñ–º–µ–Ω–µ–º ‚úÖ
   - –í–∏–±—ñ—Ä –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ ‚úÖ
   - –í–∫–ª–∞–¥–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ‚úÖ
   - –î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—î –¥–æ–¥–∞–≤–∞–Ω–Ω—è ‚úÖ (–ª–æ–≥—ñ–∫–∞ —î)
   - Offline –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è ‚úÖ
   - Mesh –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è ‚úÖ

2. **–°–ø—Ä–∞–≤–∂–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏** (2 –∑ 8)
   - –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ ‚ö†Ô∏è (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ)
   - –°—Ç–∞—Ç–∏—á–Ω–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è –∑'—î–¥–Ω–∞–Ω—å ‚ö†Ô∏è (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ)

3. **–ú–æ–∂–ª–∏–≤–∞ –ø—Ä–∏—á–∏–Ω–∞ —Å–∫–∞—Ä–≥:**
   - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–∏–≤ —ñ–º'—è –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö
   - Bluetooth –≤–∏–º–∫–Ω–µ–Ω–∏–π
   - –ö–æ–Ω—Ç–∞–∫—Ç–∏ –¥–æ–¥–∞–Ω—ñ –±–µ–∑ QR-–∫–æ–¥—É (–±–µ–∑ x25519 –∫–ª—é—á–∞)
   - Peer'–∏ –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ

### –©–æ –¥–æ–¥–∞–Ω–æ:

1. **–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** üîç
   - –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
   - –î—ñ–∞–ª–æ–≥ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
   - –ö–Ω–æ–ø–∫–∞ "–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑"

2. **–Ü–Ω–¥–∏–∫–∞—Ü—ñ—è** üìä
   - –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ (5 —Å–µ–∫)
   - –ö—ñ–ª—å–∫—ñ—Å—Ç—å peer'—ñ–≤ –≤ Mesh
   - –ö–æ–ª—å–æ—Ä–æ–≤–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è (–∑–µ–ª–µ–Ω–∏–π/—Å—ñ—Ä–∏–π)
   - –î–µ—Ç–∞–ª—å–Ω—ñ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ

3. **–õ–æ–≥—É–≤–∞–Ω–Ω—è** üìù
   - –õ–æ–≥–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
   - –õ–æ–≥–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤
   - –õ–æ–≥–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó peer'—ñ–≤
   - –õ–æ–≥–∏ –ø–æ–º–∏–ª–æ–∫ –∑ –∫–æ–¥–∞–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:

1. **–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —ñ–º'—è:** –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí –Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. **–°–∫–∞–Ω—É–≤–∞—Ç–∏ QR –ø–æ–≤–Ω—ñ—Å—Ç—é:** –ù–µ –≤–≤–æ–¥–∏—Ç–∏ ID –≤—Ä—É—á–Ω—É
3. **–£–≤—ñ–º–∫–Ω—É—Ç–∏ Bluetooth:** –î–ª—è mesh –º–µ—Ä–µ–∂—ñ
4. **–ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏:** –ó–µ–ª–µ–Ω—ñ = –ø—Ä–∞—Ü—é—î, —Å—ñ—Ä—ñ = –≤–∏–º–∫–Ω–µ–Ω–æ
5. **–ß–∏—Ç–∞—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É:** –ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

### –î–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞:

1. **Build —Ç–∞ test –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó** ‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
2. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –≤—Å—ñ 8 —Ç–µ—Å—Ç—ñ–≤** (–¥–∏–≤. —Ä–æ–∑–¥—ñ–ª "–ü–ª–∞–Ω —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è")
3. **–ó—ñ–±—Ä–∞—Ç–∏ –ª–æ–≥–∏** –∑ —Ä–µ–∞–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
4. **–í–∏–ø—Ä–∞–≤–∏—Ç–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ –±–∞–≥–∏** (—è–∫—â–æ –±—É–¥—É—Ç—å)

### –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

1. **–û–Ω–æ–≤–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫** –¥–æ –≤–µ—Ä—Å—ñ—ó 0.2.0-rc1
2. **–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —ñ–º'—è** –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö
3. **–ü–µ—Ä–µ—Å–∫–∞–Ω—É–≤–∞—Ç–∏ QR-–∫–æ–¥–∏** –≤—Å—ñ—Ö –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤
4. **–£–≤—ñ–º–∫–Ω—É—Ç–∏ Bluetooth** –¥–ª—è mesh –º–µ—Ä–µ–∂—ñ
5. **–ó–≤–µ—Ä—Ç–∞—Ç–∏ —É–≤–∞–≥—É –Ω–∞ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏** (–Ω–∏–∑ –µ–∫—Ä–∞–Ω—É)

### –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:

1. **–û–Ω–±–æ—Ä–¥–∏–Ω–≥** - –ø–æ–∫–∞–∑–∞—Ç–∏ tutorial –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É
2. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è QR** - –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `name` —Ç–∞ `x` –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π retry** - –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
4. **Push –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** - –ø—Ä–æ —É—Å–ø—ñ—à–Ω—É –¥–æ—Å—Ç–∞–≤–∫—É
5. **–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –º–∞—Ä—à—Ä—É—Ç—É** - –ø–æ–∫–∞–∑–∞—Ç–∏ A‚ÜíB‚ÜíC —à–ª—è—Ö

---

## üìÑ –§–∞–π–ª–∏ –ø—Ä–æ–µ–∫—Ç—É

**–ó–º—ñ–Ω–µ–Ω—ñ:**
- `MainFragment.kt` (+150 lines)

**–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ (–±–µ–∑ –∑–º—ñ–Ω):**
- `FamilyFragment.kt` ‚úÖ
- `InboxFragment.kt` ‚úÖ
- `QrCodeActivity.kt` ‚úÖ
- `TransportService.kt` ‚úÖ
- `fragment_inbox.xml` ‚úÖ

**Rust core (–±–µ–∑ –∑–º—ñ–Ω):**
- `ya_ok_core/src/api/mod.rs` ‚úÖ
- `ya_ok_core/src/routing/mod.rs` ‚úÖ
- `ya_ok_core/src/routing/queue.rs` ‚úÖ

---

**–ì–æ—Ç–æ–≤–æ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–ª—ñ–∑—É! üéâ**
